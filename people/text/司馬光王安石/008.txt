
王安石在宋神宗的支持下行新政，諫議大夫司馬光竭力反對，強調祖宗之法不可變，雙方針鋒相對。熙寧二年神宗命司馬光為樞密副使，希望他停止阻撓新政，但司馬光以「不通財務」、「不習軍旅」為理由，堅持不就，熙寧三年（1070年）二月，司馬光自請離京，出任地方官「知永興軍」（宋朝的永興軍即唐朝首都長安，今陝西省西安市），次年司馬光退居洛陽，任「西京留守兼西京御史臺」，宋朝西京即洛陽。神宗批准他繼續編撰史書，以書局自隨，自此之後，司馬光長居洛陽，在他的重要助手劉恕、劉攽、范祖禹及兒子司馬康等人協助下，專心修史，絕口不論政事。

元豐七年（1084年）七月，全書二百九十四卷，三百萬字，記述上起戰國，下迄五代末年，共一千三百六十二年的編年史編撰完成，司馬光連同《考異》、《目錄》一起進奏給神宗皇帝。司馬光在進呈書稿時表示，撰史的「專取關國家興衰，繫生民休戚，善可為法，惡可為戒者，為編年一書」。他有系統地講述史上的治亂興衰和施政、軍事得失，統治者的成敗，百姓所感受的善惡，總結治國理政的經驗和教訓，向包括皇帝在内的讀者提供歷史的借鑑。神宗對此十分重視，讚揚司馬光「博學多聞，貫穿今古，上自晚周，下迄五代，成一家之書，褒貶去取，有所據依」，以其書「有鑑於往事，以資於治道」，賜書名《資治通鑑》，並親為寫序，降旨出版刊行。《資治通鑑》成為後世學者和政治領袖所重視的「帝王教科書」。司馬光當時已六十六歲，編撰《資治通鑑》前後十九年，其中在洛陽專注撰書十五年。他為此耗盡精力，據他自述：「臣今骸骨癯瘁，目視昏近，齒牙無幾，神識衰耗，目前所為，旋踵遺忘。臣之精力，盡於此書！」
