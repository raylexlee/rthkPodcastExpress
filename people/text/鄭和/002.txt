元朝統治中原差不多一百年，到了元朝末代君主元順帝年間，賽典赤．瞻思丁家族，在雲南定居亦已經超過一百年，經歷了五到六代人，發展為人口數百，分為好幾個姓氏的色目人家族。其中賽典赤第五子馬速忽的後裔改姓馬，定居在滇池旁邊的昆陽。馬速忽的曾孫米里金，曾經到過麥加朝聖，被人尊稱為「哈只」，意思是朝聖者，因此別人稱他為馬哈只。馬哈只為人正直，樂善好施，所以甚得當地民眾敬重，他的夫人姓溫，長子馬文銘，次子馬文和，亦即馬和，年幼時稱為馬三保。馬三保生於1371年，亦即明洪武四年。當時元朝已經被明朝擊敗，元順帝已經退出中原，但明朝尚未統一天下。馬三保的家鄉雲南，仍然是元朝分封的梁王割據，馬哈只一家，仍然是元朝梁王的臣民。馬哈只家族雖然世代信奉伊斯蘭教，但並不抗拒中國文化，他非常重視子弟的教育，因此馬三保自幼學習詩書文章，有「才負經緯，文通孔孟」的美譽。

明洪武四年，明朝大軍攻入四川，擊敗割據四川的明玉珍後人，將四川納入明朝版圖。雲南鄰接四川，明朝派使者招降，但梁王自恃地勢險阻，拒絕明朝的招撫，而且與管治大理的段氏土司結盟，殺害明朝使者，抵抗明軍入侵。到了洪武十四年，即公元1381年九月，明太祖見時機成熟，任命潁川侯傅友德為征南大將軍，永昌侯藍玉、西平侯沐英分別為左、右副將軍，統領三十萬大軍，兵分兩路征伐雲南。北路軍由四川南下，東路軍由湖廣辰州經普定、普安等土官管治地區，亦即今日貴州省，直指雲南曲靖，兩路大軍在曲靖會合，抵達白石江北岸。元朝梁王得知明軍來犯，立刻調動兵馬在曲靖北郊的白石江南岸佈防，兩軍在白石江戰開決戰。

明軍統帥傅友德親自在白石江前線指揮作戰，將士奮勇渡江，元朝梁王軍隊兵敗山倒，明軍勢如破竹，直插雲南首府中慶城，亦即今日昆明市。梁王在數年之前圖謀兼大理段氏領地，與段氏結怨，明軍來犯，大理段氏歸附明朝，梁王兵敗援絕，棄城逃走，最後被明軍追到，見大勢已去，投滇池而死。梁王丞相觀音保等官員投降明朝。此後，明軍經過半年激戰，相繼攻克大理、麗江、鶴慶等地，控制雲南全境，設立雲南行省。洪武十七年，傅友德、藍玉率領南征大軍班師回朝，而沐英奉命留守雲南。

在明朝大軍征伐雲南期間，馬哈只作為元朝梁王麾下的將領，參與抗拒明軍，為保衛梁王而戰死，終年三十九歲。明軍攻佔雲南之後，馬哈只家屬成為戰俘。古代戰爭的習慣，未成年的戰俘，分派給功臣將士，女為奴，男為僕。當時馬三保只得十歲左右，與一大批年幼俘虜被押送軍營成為雜役，明朝大軍班師回，馬三保等俘虜隨同大軍送往當時的京城應天，即今日的南京。到達應天之後，十三歲左右的馬三保，被挑選為宦官，送入宮中為僕役，從此改變了馬三保的一生。
